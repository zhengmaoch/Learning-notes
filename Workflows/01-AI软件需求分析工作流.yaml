version: "1.2.0"
app:
  name: "AIéœ€æ±‚åˆ†æåŠ©æ‰‹"
  description: "åŸºäºOllamaæ¨¡å‹çš„è½¯ä»¶éœ€æ±‚åˆ†æå·¥ä½œæµ"
  icon: "ğŸ“‹"
  mode: "workflow"
  enable_site: true
  api_rpm: 30

models:
  - id: "deepseek-r1-14b"
    type: "llm"
    provider: "ollama"
    name: "deepseek-r1-14b"
    parameters:
      temperature: 0.7
      max_tokens: 4096
      top_p: 0.9
    credentials:
      base_url: "http://localhost:11434"

  - id: "nomic-embed-text"
    type: "text_embedding"
    provider: "ollama"
    name: "nomic-embed-text"
    credentials:
      base_url: "http://localhost:11434"

workflows:
  - name: "éœ€æ±‚åˆ†æä¸»æµç¨‹"
    nodes:
      - id: "input_node"
        type: "start"
        position: {x: 100, y: 100}
        data:
          variables:
            - name: "raw_requirements"
              type: "string"
              required: true
              description: "åŸå§‹éœ€æ±‚æè¿°"

      - id: "req_classification"
        type: "llm"
        model: "deepseek-r1-14b"
        position: {x: 350, y: 100}
        data:
          prompt: |
            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è½¯ä»¶éœ€æ±‚åˆ†æå¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹éœ€æ±‚æè¿°è¿›è¡Œåˆ†ç±»å’Œæ ‡ç­¾åŒ–ï¼š
            
            {{raw_requirements}}
            
            è¯·æŒ‰ä»¥ä¸‹æ ¼å¼å“åº”ï¼š
            - éœ€æ±‚ç±»å‹ï¼š[åŠŸèƒ½/éåŠŸèƒ½/ä¸šåŠ¡/æŠ€æœ¯]
            - ä¼˜å…ˆçº§ï¼š[é«˜/ä¸­/ä½]
            - ç›¸å…³æ¨¡å—ï¼š[æ¨¡å—1,æ¨¡å—2,...]
            - å…³é”®è¯ï¼š[å…³é”®è¯1,å…³é”®è¯2,...]
          output:
            - name: "req_type"
              type: "string"
            - name: "priority"
              type: "string"
            - name: "modules"
              type: "list"
            - name: "keywords"
              type: "list"

      - id: "ambiguity_detection"
        type: "llm"
        model: "deepseek-r1-14b"
        position: {x: 350, y: 250}
        data:
          prompt: |
            åˆ†æä»¥ä¸‹éœ€æ±‚æè¿°ï¼Œè¯†åˆ«å…¶ä¸­çš„æ¨¡ç³Šç‚¹å’Œéœ€è¦æ¾„æ¸…çš„é—®é¢˜ï¼š
            
            {{raw_requirements}}
            
            è¾“å‡ºæ ¼å¼ï¼š
            - æ¨¡ç³Šç‚¹1ï¼š[æè¿°]
            - æ¾„æ¸…é—®é¢˜1ï¼š[é—®é¢˜]
            - æ¨¡ç³Šç‚¹2ï¼š[æè¿°]
            - æ¾„æ¸…é—®é¢˜2ï¼š[é—®é¢˜]
            ...
          output:
            - name: "ambiguities"
              type: "list"
            - name: "clarification_questions"
              type: "list"

      - id: "doc_generation"
        type: "llm"
        model: "deepseek-r1-14b"
        position: {x: 600, y: 100}
        data:
          prompt: |
            åŸºäºä»¥ä¸‹éœ€æ±‚ä¿¡æ¯ï¼Œç”Ÿæˆç»“æ„åŒ–éœ€æ±‚æ–‡æ¡£ï¼š
            
            åŸå§‹éœ€æ±‚ï¼š{{raw_requirements}}
            éœ€æ±‚ç±»å‹ï¼š{{req_type}}
            ä¼˜å…ˆçº§ï¼š{{priority}}
            ç›¸å…³æ¨¡å—ï¼š{{modules}}
            
            è¯·æŒ‰ä»¥ä¸‹æ ¼å¼ç”Ÿæˆæ–‡æ¡£ï¼š
            # éœ€æ±‚æ–‡æ¡£
            
            ## 1. éœ€æ±‚æ¦‚è¿°
            [å†…å®¹]
            
            ## 2. è¯¦ç»†æè¿°
            [å†…å®¹]
            
            ## 3. ç”¨æˆ·æ•…äº‹
            [å†…å®¹]
            
            ## 4. éªŒæ”¶æ ‡å‡†
            [å†…å®¹]
          output:
            - name: "requirement_doc"
              type: "string"

      - id: "similar_req_search"
        type: "embedding_search"
        model: "nomic-embed-text"
        position: {x: 600, y: 250}
        data:
          dataset_id: "historical_requirements"
          query: "{{raw_requirements}}"
          top_k: 3
          output:
            - name: "similar_requirements"
              type: "list"

      - id: "conflict_detection"
        type: "llm"
        model: "deepseek-r1-14b"
        position: {x: 850, y: 100}
        data:
          prompt: |
            åˆ†æä»¥ä¸‹æ–°éœ€æ±‚ä¸å†å²ç›¸ä¼¼éœ€æ±‚çš„æ½œåœ¨å†²çªï¼š
            
            æ–°éœ€æ±‚ï¼š{{raw_requirements}}
            
            ç›¸ä¼¼å†å²éœ€æ±‚ï¼š
            {% for req in similar_requirements %}
            - {{req.content}}
            {% endfor %}
            
            è¯·è¯†åˆ«æ½œåœ¨å†²çªå¹¶æå‡ºè§£å†³æ–¹æ¡ˆå»ºè®®ã€‚
          output:
            - name: "potential_conflicts"
              type: "list"
            - name: "resolution_suggestions"
              type: "list"

      - id: "output_node"
        type: "end"
        position: {x: 1100, y: 100}
        data:
          outputs:
            - name: "requirement_doc"
              type: "string"
              reference: "doc_generation.requirement_doc"
            - name: "clarification_needed"
              type: "list"
              reference: "ambiguity_detection.clarification_questions"
            - name: "potential_conflicts"
              type: "list"
              reference: "conflict_detection.potential_conflicts"

    edges:
      - source: "input_node"
        target: "req_classification"
        sourceHandle: "output"
        targetHandle: "raw_requirements"

      - source: "input_node"
        target: "ambiguity_detection"
        sourceHandle: "output"
        targetHandle: "raw_requirements"

      - source: "input_node"
        target: "doc_generation"
        sourceHandle: "output"
        targetHandle: "raw_requirements"

      - source: "input_node"
        target: "similar_req_search"
        sourceHandle: "output"
        targetHandle: "query"

      - source: "req_classification"
        target: "doc_generation"
        sourceHandle: "req_type"
        targetHandle: "req_type"

      - source: "req_classification"
        target: "doc_generation"
        sourceHandle: "priority"
        targetHandle: "priority"

      - source: "req_classification"
        target: "doc_generation"
        sourceHandle: "modules"
        targetHandle: "modules"

      - source: "similar_req_search"
        target: "conflict_detection"
        sourceHandle: "similar_requirements"
        targetHandle: "similar_requirements"

      - source: "doc_generation"
        target: "output_node"
        sourceHandle: "requirement_doc"
        targetHandle: "requirement_doc"

      - source: "ambiguity_detection"
        target: "output_node"
        sourceHandle: "clarification_questions"
        targetHandle: "clarification_needed"

      - source: "conflict_detection"
        target: "output_node"
        sourceHandle: "potential_conflicts"
        targetHandle: "potential_conflicts"

datasets:
  - id: "historical_requirements"
    name: "å†å²éœ€æ±‚åº“"
    description: "å­˜å‚¨å†å²éœ€æ±‚æ–‡æ¡£ç”¨äºç›¸ä¼¼æ€§æœç´¢"
    document_type: "text"
    indexing_technique: "high_quality"
    embedding_model: "nomic-embed-text"
    metadata_schema:
      - name: "project"
        type: "string"
      - name: "date"
        type: "date"
      - name: "status"
        type: "string"